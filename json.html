<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>M3U → JSON (Group + Download)</title>
<style>
body {
  background:#0b0b0b;
  color:#00ff99;
  font-family: monospace;
  padding:10px;
}
button {
  padding:6px 12px;
  margin-bottom:10px;
}
pre {
  white-space: pre-wrap;
  word-break: break-word;
}
</style>
</head>
<body>

<h3>M3U → JSON (group-title)</h3>
<button id="download">⬇ Download playlist.json</button>
<pre id="out">Loading...</pre>

<script>
const SOURCE_URL =
  "https://raw.githubusercontent.com/vuminhthanh12/vuminhthanh12/refs/heads/main/vmttv";

const PROXY =
  "https://proxy.corsfix.com/?";

let FINAL_JSON = null;

fetch(PROXY + encodeURIComponent(SOURCE_URL))
  .then(r => r.text())
  .then(text => {
    const lines = text.split("\n").map(l => l.trim());
    const groups = {};

    for (let i = 0; i < lines.length; i++) {
      if (lines[i].startsWith("#EXTINF")) {
        const extinf = lines[i];

        const getAttr = (name) => {
          const m = extinf.match(new RegExp(name + '="([^"]*)"'));
          return m ? m[1] : "";
        };

        const name = extinf.split(",").pop().trim();
        const group = getAttr("group-title") || "OTHER";

        // bỏ qua #EXTVLCOPT nếu có
        let stream = "";
        for (let j = i + 1; j < i + 4; j++) {
          if (lines[j]?.startsWith("http")) {
            stream = lines[j];
            break;
          }
        }

        if (!groups[group]) groups[group] = [];

        groups[group].push({
          name,
          tvg_id: getAttr("tvg-id"),
          logo: getAttr("tvg-logo"),
          catchup: getAttr("catchup"),
          catchup_days: getAttr("catchup-days"),
          catchup_source: getAttr("catchup-source"),
          stream
        });
      }
    }

    FINAL_JSON = {
      source: SOURCE_URL,
      group_count: Object.keys(groups).length,
      groups
    };

    console.log(FINAL_JSON);
    document.getElementById("out").textContent =
      JSON.stringify(FINAL_JSON, null, 2);
  })
  .catch(err => {
    document.getElementById("out").textContent = err.message;
  });

document.getElementById("download").onclick = () => {
  if (!FINAL_JSON) return;

  const blob = new Blob(
    [JSON.stringify(FINAL_JSON, null, 2)],
    { type: "application/json" }
  );

  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "playlist.json";
  a.click();
};
</script>

</body>
</html>
