<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>MyTV JSON → M3U (No Encode)</title>
<style>
  body {
    background:#020617;
    color:#e5e7eb;
    font-family: monospace;
    padding:16px;
  }
  button {
    background:#22c55e;
    border:none;
    padding:10px 16px;
    font-size:16px;
    border-radius:6px;
    cursor:pointer;
  }
  textarea {
    width:100%;
    height:320px;
    margin-top:10px;
    background:#020617;
    color:#86efac;
    padding:10px;
    border-radius:6px;
  }
</style>
</head>
<body>

<h2>MyTV JSON → M3U</h2>
<button onclick="convert()">Fetch & Convert</button>

<textarea id="out">#EXTM3U</textarea>

<script>
/* ❌ KHÔNG encode URI */
const API =
  "https://api.allorigins.win/raw?url=https://apigw.mytv.vn/api/v1/channel?cate_id=undefined&uuid=f720b0ad78a1224b893fdfe3aeeb4b071763206372868&req_id=f720b0ad78a1224b893fdfe3aeeb4b07%7C1763206405313";

// đổi RTP → HTTP proxy
function convertRTP(url) {
  if (!url || !url.startsWith("rtp://")) return url;
  return "http://14.255.66.32:8989/rtp/" + url.replace("rtp://", "");
}

async function convert() {
  const out = document.getElementById("out");
  out.value = "Đang tải JSON...\n";

  try {
    const res = await fetch(API);
    const json = await res.json();

    let m3u = "#EXTM3U\n";
    let count = 0;

    const list = json.data || [];

    list.forEach(ch => {
      if (!ch.url_b2c || !ch.name) return;

      const name = ch.name;
      const logo = ch.logo || "";
      const url = convertRTP(ch.url_b2c);

      m3u += `#EXTINF:-1 tvg-id="${ch.id}" tvg-name="${name}" tvg-logo="${logo}" group-title="MyTV",${name}\n`;
      m3u += url + "\n";
      count++;
    });

    out.value = m3u + `\n# Tổng kênh: ${count}`;
    download(m3u, "mytv.m3u");

  } catch (e) {
    out.value = "Lỗi: " + e;
  }
}

function download(text, filename) {
  const blob = new Blob([text], { type: "audio/x-mpegurl" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
}
</script>

</body>
</html>
