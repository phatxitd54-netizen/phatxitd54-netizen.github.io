<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="referrer" content="no-referrer"/>
    <title>vAppTV - Media Fullscreen Player</title>
    <script src="https://cdn.jsdelivr.net/npm/shaka-player@4.3.5/dist/shaka-player.compiled.js"></script>
    <style>html, body { margin: 0; padding: 0; background: black; height: 100%; width: 100%; overflow: hidden; } video { width: 100%; height: 100%; object-fit: contain; /* hoặc contain tùy ý */ background-color: black; }</style>
  </head>
  <body>
    <audio id="audio" autoplay="" playsinline="" volume="100"></audio>
    <video id="video" autoplay="" playsinline=""/>
    <script>function getQueryParams() { const params = new URLSearchParams(window.location.search); let keys = params.get(''); if (!keys &amp;&amp; params.get('keyId') &amp;&amp; params.get('key')) { keys = params.get('keyId') + ':' + params.get('key'); } return { keys: keys, videoUrl: params.get('videoUrl'), audioUrl: params.get('audioUrl') }; } function sendMessage(msg) { if (window.ReactNativeWebView &amp;&amp; window.ReactNativeWebView.postMessage) { window.ReactNativeWebView.postMessage(JSON.stringify(msg)); } } async function initAudioPlayer(){ const { keyId, key, audioUrl } = getQueryParams(); const audio = document.getElementById('audio'); audio.src = audioUrl; sendMessage({ type: 'loaded' }); // Bắt đầu phát audio.addEventListener('playing', () =&gt; sendMessage({ type: 'playing' })); // Tạm dừng audio.addEventListener('pause', () =&gt; sendMessage({ type: 'paused' })); // Buffering - khi trình duyệt đang nạp dữ liệu audio.addEventListener('waiting', () =&gt; sendMessage({ type: 'buffering' })); // Khi đã đủ dữ liệu để phát tiếp audio.addEventListener('canplay', () =&gt; sendMessage({ type: 'buffering_complete' })); // Khi đang tải dữ liệu (có thể dùng để hiển thị loading) // audio.addEventListener('progress', () =&gt; sendMessage({ // type: 'buffering' // })); audio.addEventListener('error', (e) =&gt; { const error = e.target.error; let message = 'Unknown error'; switch (error.code) { case error.MEDIA_ERR_ABORTED: message = 'You aborted the audio playback.'; break; case error.MEDIA_ERR_NETWORK: message = 'A network error caused the audio download to fail.'; break; case error.MEDIA_ERR_DECODE: message = 'The audio playback was aborted due to a corruption problem or unsupported features.'; break; case error.MEDIA_ERR_SRC_NOT_SUPPORTED: message = 'The audio file could not be loaded because the format is not supported.'; break; } sendMessage({ type: 'error', message: message }); }); audio.play() } async function initVideoPlayer() { const { keys, videoUrl } = getQueryParams(); const video = document.getElementById('video'); const player = new shaka.Player(video); let config = {} if (keys) { const keyList = keys.split(','); let drmConfig = {}; keyList.forEach((item, index) =&gt; { const key = item.split(':'); if (key.length === 2) { drmConfig[key[0]] = key[1] } }); if (Object.keys(drmConfig).length &gt; 0){ config = { drm: { clearKeys: drmConfig }, }; } } console.log(config) player.configure(config); // Listen for buffering events player.addEventListener('buffering', function(event) { if (event.buffering) { // Gửi thông báo trạng thái buffering sendMessage({ type: 'buffering' }); } else { // Gửi thông báo kết thúc buffering sendMessage({ type: 'buffering_complete' }); } }); // Listen for error events player.addEventListener('error', function(event) { // Lấy thông tin lỗi const error = event.detail; const errorMessage = `Error code: ${error.code}, message: ${error.message}`; // Gửi thông báo lỗi về React Native sendMessage({ type: 'error', message: errorMessage }); }); try { await player.load(videoUrl); sendMessage({ type: 'loaded' }); } catch (error) { sendMessage({ type: 'error', message: 'Load failed', detail: error.toString() }); } video.addEventListener('play', () =&gt; sendMessage({ type: 'playing' })); video.addEventListener('pause', () =&gt; sendMessage({ type: 'paused' })); } async function initPlayer() { const {videoUrl, audioUrl } = getQueryParams(); if (videoUrl) { return initVideoPlayer() } if (audioUrl) { return initAudioPlayer() } } // Nhận lệnh từ React Native window.addEventListener("message", (event) =&gt; { const {videoUrl, audioUrl } = getQueryParams(); let player; if (videoUrl){ player = document.getElementById('video'); } else { player = document.getElementById('audio'); } if (event.data === 'play') player.play(); else if (event.data === 'pause') player.pause(); }); document.addEventListener('DOMContentLoaded', initPlayer);</script>
  </body>
</html>