<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shaka Player</title>

  <!-- Shaka -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.16.3/shaka-player.compiled.js"></script>

  <!-- Shaka Controls CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.16.3/controls.min.css"/>

  <style>
    body, html {
      margin: 0;
      padding: 0;
      background: black;
      width: 100%;
      height: 100%;
    }
    #video-container {
      width: 100%;
      height: 100%;
    }
    video {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>

<div id="video-container" data-shaka-player-container>
  <video id="video" data-shaka-player autoplay></video>
</div>

<script>
function getQueryParams() {
  const params = new URLSearchParams(window.location.search);
  return {
    videoUrl: params.get("https://livevlisctcdnw.seenow.vn/livesnv2/THETHAO_HD/manifest.mpd"),
    keys: params.get("dcda1c0511c347f8b89c1821600426ac:dbc1d4d9244f8e7d01d999d4d9f53855")
  };
}

async function init() {
  const { videoUrl, keys } = getQueryParams();
  const video = document.getElementById("video");

  const player = new shaka.Player(video);
  const ui = new shaka.ui.Overlay(player, video.parentElement, video);

  let config = {};

  if (keys) {
    const keyList = keys.split(",");
    let drmConfig = {};

    keyList.forEach(item => {
      const parts = item.split(":");
      if (parts.length === 2) {
        drmConfig[parts[0]] = parts[1];
      }
    });

    if (Object.keys(drmConfig).length > 0) {
      config = {
        drm: {
          clearKeys: drmConfig
        }
      };
    }
  }

  player.configure(config);

  try {
    await player.load(videoUrl);
    console.log("Loaded!");
  } catch (e) {
    console.error("Error loading video:", e);
  }
}

document.addEventListener("DOMContentLoaded", init);
</script>

</body>
</html>
